import{_ as I}from"./BillItemTable-D2cJ4zdq.js";import{u}from"./app-BkSPzRLz.js";import{d as _,o as m,c as v,w as a,a as s,e as o,b as B,h as V,F as g,g as h,t as S}from"./index-Br9qntu-.js";import{_ as y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as C,a as c,b as k,c as $,d as N,e as T}from"./forwardRefs-B4cOXIfo.js";import{V as j}from"./VDialog-CaCeG4bo.js";const O=_({name:"SplitBillPopup",props:{modelValue:{type:Boolean,default:!1}},emits:["close","update:modelValue"],data:()=>({billItems:{},childBillIds:[1,2,3,4],selectedBillItem:null}),computed:{appStore:()=>u(),currentBill:()=>u().currentBill},watch:{modelValue(e){e&&(this.billItems=Object.keys(this.appStore.currentBill.itemList).reduce((l,t)=>({...l,[t]:{...this.appStore.currentBill.itemList[t],bill:0}}),{}),this.childBillIds=Array.from({length:Object.keys(this.billItems).length},(l,t)=>t+1))}},methods:{onChanged(e){this.$emit("update:modelValue",e)},addChildBill(){this.childBillIds.push(Math.min(...this.childBillIds)+1)},getItemByBillId(e){return Object.values(this.billItems).reduce((l,t)=>({...l,...t.bill===e?{[t.name]:t}:{}}),{})},moveItemToBill(e){this.selectedBillItem&&(this.billItems[this.selectedBillItem].bill=e,this.selectedBillItem=null)},splitBill(){const e=`#${+new Date}`;let l=1,t=null;for(const p of[0,...this.childBillIds]){const d=this.getItemByBillId(p);if(Object.keys(d).length>0){const r=Object.keys(d).reduce((n,i)=>({...n,[i]:{name:d[i].name,price:d[i].price,qty:d[i].qty,note:d[i].note}}),{});t||(t={tableName:`${e}.${l}`,customerName:this.currentBill.customerName,itemList:r}),this.appStore.addTable(`${e}.${l}`,this.currentBill.customerName,r),l++}}this.appStore.currentBill.tableName&&this.appStore.removeTable(this.appStore.currentBill.tableName),this.appStore.setCurrentBill(t),this.$emit("close")}}}),w={class:"dialog-title__actions"},L={class:"bill-popup"},A={class:"main-bill"},D={class:"split-bills"},P={class:"child-bill__content"},q={class:"child-bill__table"},F={class:"child-bill__actions"};function M(e,l,t,p,d,r){const n=I;return m(),v(j,{class:"popup-dialog",modelValue:e.modelValue,"onUpdate:modelValue":e.onChanged},{default:a(()=>[s(T,null,{default:a(()=>[s(C,null,{default:a(()=>[l[3]||(l[3]=o("div",{class:"dialog-title__text"},"Split bill",-1)),o("div",w,[s(c,{onClick:l[0]||(l[0]=i=>e.onChanged(!1)),class:"btn-close"},{default:a(()=>[s(k,{icon:"mdi-close"})]),_:1})])]),_:1}),s($,null,{default:a(()=>[o("div",L,[o("div",A,[s(n,{items:e.getItemByBillId(0),"selected-item":e.selectedBillItem,onSelected:l[1]||(l[1]=i=>e.selectedBillItem=i.name)},null,8,["items","selected-item"])]),o("div",D,[(m(!0),B(g,null,V(e.childBillIds,(i,b)=>(m(),B("div",{key:i,class:"child-bill"},[o("div",null,"Bill #"+S(b+1),1),o("div",P,[o("div",q,[s(n,{items:e.getItemByBillId(i),"selected-item":e.selectedBillItem,onSelected:l[2]||(l[2]=f=>e.selectedBillItem=f.name)},null,8,["items","selected-item"])]),o("div",F,[s(c,{variant:"elevated",color:"primary",onClick:()=>e.moveItemToBill(i)},{default:a(()=>l[4]||(l[4]=[h("Move here")])),_:2},1032,["onClick"])])])]))),128))])])]),_:1}),s(N,null,{default:a(()=>[s(c,{variant:"elevated",color:"primary",onClick:e.splitBill},{default:a(()=>l[5]||(l[5]=[h("Split bill")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])}const K=y(O,[["render",M],["__scopeId","data-v-7a79083f"]]);export{K as default};
